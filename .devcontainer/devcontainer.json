{
    // Reference: https://code.visualstudio.com/docs/remote/devcontainerjson-reference

    "name": "Anno from Dockerfile",

    // Sets the run context to one level up instead of the .devcontainer folder.
    "context": "..",

    // Update the 'dockerFile' property if you aren't using the standard 'Dockerfile' filename.
    "dockerFile": "../Dockerfile",

    // Set *default* container specific settings.json values on container create.
    "settings": {
        "terminal.integrated.defaultProfile.linux": "bash",
        "editor.formatOnSave": true,
        "editor.defaultFormatter": "esbenp.prettier-vscode",
        "[python]": {
            "editor.defaultFormatter": null
        },
        "python.linting.flake8Enabled": true,
        "python.linting.pylintEnabled": false,
        "python.linting.mypyEnabled": true,
        "python.linting.enabled": true,
        "python.formatting.provider": "black",
        "python.formatting.blackPath": "black",
        "python.linting.flake8Path": "flake8",
        "python.languageServer": "Pylance",
        "python.analysis.extraPaths": ["${containerWorkspaceFolder}/src"],
        "python.testing.pytestEnabled": true,
        "python.testing.cwd": "${containerWorkspaceFolder}"
    },

    // Extensions are cached on a docker volume (see mounts)
    // This volume must be deleted to see extension updates/changes
    "extensions": [
        "esbenp.prettier-vscode",
        "foxundermoon.shs-format",
        "gitlab.gitlab-workflow",
        "ms-azuretools.vscode-docker",
        "ms-python.python",
        "ms-python.vscode-pylance",
        "timonwong.shellcheck",
        "yzhang.markdown-all-in-one"
    ],

    "build": {
        "target": "builder"
    },

    "containerEnv": {
        // doesn't seem to be a good way to avoid duplicating certain base paths
        // in variable definitions below. Values taken from Makefile var defaults and `make run`
        "ANNO_DATA": "${containerWorkspaceFolder}/data",
        "ANNO_RAWDATA": "${containerWorkspaceFolder}/rawdata",
        "ANNO": "${containerWorkspaceFolder}",
        "API_PORT": "6000",
        "FASTA": "${containerWorkspaceFolder}/data/FASTA/human_g1k_v37_decoy.fasta.gz",
        "LD_LIBRARY_PATH": "${containerWorkspaceFolder}/thirdparty/ensembl-vep-release/htslib",
        "PIPENV_NOSPIN": "1",
        "PYTHONPATH": "${containerWorkspaceFolder}/src",
        "SAMPLES": "${containerWorkspaceFolder}/sample-repo",
        "TARGETS_OUT": "${containerWorkspaceFolder}/anno-targets-out",
        "TARGETS": "${containerWorkspaceFolder}/tests/testdata/targets",
        "WORKFOLDER": "/tmp/annowork"
    },

    // docker exec directly to container if root access is necessary
    "containerUser": "anno-user",
    "forwardPorts": [6000],

    "workspaceMount": "source=${localWorkspaceFolder},target=/anno,type=bind",
    // cache extensions to save time on container rebuild
    "mounts": [
        "source=${localWorkspaceFolderBasename}-exts,target=/home/vscode/.vscode-server/extensions,type=volume"
        // Override workspace settings, tasks and launch configs. Uncomment to keep workspace configs.
        // "source=${localWorkspaceFolder}/.devcontainer,target=/anno/.vscode,type=bind"
    ],

    "workspaceFolder": "/anno"
}
